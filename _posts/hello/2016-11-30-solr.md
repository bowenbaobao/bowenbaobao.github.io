---
layout: post
title: solr 笔记
permalink: /:categories/solr_url/
date: 2016-11-01 09:30:15 +0800
category: Java Search
tags: [solr]
---



### solr 环境搭建

[参考网站](http://www.luoshengsha.com/139.html "http://www.luoshengsha.com/139.html")

#### 下载solr

zip解压 , E:\bw168\solr-4.10.4

#### 部署到tomcat

E:\bw168\solr-4.10.4\example\webapps\solr.war   拷贝到tomcat–>weapps中

E:\bw168\apache-tomcat-8.0.24-windows-x86\apache-tomcat-8.0.24\webapps\solr

#### 新增solr_home

新增E:\bw168\solr_home  ,   将 E:\bw168\solr-4.10.4\example\solr  目录拷贝到  E:\bw168\solr_home


#### 启动tomcat

启动tomcat，此时tomcat会把solr.war进行解压，生成一个solr文件夹；停止tomcat，删除solr.war。


#### 修改solr_home

tomcat下面的solr/WEB-INF/web.xml

```
 <env-entry>
       <env-entry-name>solr/home</env-entry-name>
       <env-entry-value>E:/bw168/solr_home/</env-entry-value>
       <env-entry-type>java.lang.String</env-entry-type>
 </env-entry>
```

#### 启动tomcat     

[http://localhost:8080/solr](http://localhost:8080/solr "http://localhost:8080/solr")


### solr 配置


#### 配送数据源


1.E:\bw168\apache-tomcat-8.0.24-windows-x86\apache-tomcat-8.0.24\webapps\solr\WEB-INF\lib

mysql-connector-java-5.1.24.jar


2.在E:\bw168\solr_home\collection1\conf 下 新增  data-config.xml

```

<?xml version="1.0" encoding="UTF8"?> 
<dataConfig>
    <dataSource  type="JdbcDataSource"  driver="com.mysql.jdbc.Driver" url="jdbc:mysql://172.16.20.213:3306/wms" user="wms" password="devDb150530"/>
	
    <document name="Info" pk="id">
        <entity name="ecnew"  transformer="ClobTransformer" pk="id"
                 query="SELECT  id,title   FROM t_ecnew"       
                 deltaImportQuery="SELECT  id,title FROM t_ecnew where update_time > '${dataimporter.last_index_time}'"   
                 deltaQuery="SELECT  id FROM t_ecnew where update_time > '${dataimporter.last_index_time}'"
				 deletedPkQuery="select ID from t_ecnew where STATUS=1  OR  ecnew_status=1 ">  
					<field column="id"         name="id"      /> 
                    <field column="title"      name="title"   /> 
         </entity>
    </document>
</dataConfig>



```

3.E:\bw168\solr_home\collection1\conf  目录下


然后在本目录下编辑配置文件：solrconfig.xml

找到很多个requestHandler节点，在最下面增加：

```

<!--  bowen  sorl 全量索引-->
<requestHandler name="/dataimport" class="org.apache.solr.handler.dataimport.DataImportHandler"> 
    <lst name="defaults"> 
          <str name="config">E:\bw168\solr_home\collection1\conf\data-config.xml</str>
	</lst> 
</requestHandler>

    <!--  bowen  sorl 增量索引-->
<requestHandler name="/deltaimport" class="org.apache.solr.handler.dataimport.DataImportHandler"> 
    <lst name="defaults"> 
          <str name="config">E:\bw168\solr_home\collection1\conf\delta-data-config.xml</str>
	</lst> 
</requestHandler>



```


4. 将初次下载的solr-4.10.4文件夹下的dist, contrib文件夹复制到TomCat根目录下


5.



